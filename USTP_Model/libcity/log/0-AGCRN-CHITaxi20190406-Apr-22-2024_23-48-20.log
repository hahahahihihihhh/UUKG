2024-04-22 23:48:20,772 - INFO - Log directory: ./libcity/log
2024-04-22 23:48:20,772 - INFO - Begin pipeline, task=traffic_state_pred, model_name=AGCRN, dataset_name=CHITaxi20190406, exp_id=0
2024-04-22 23:48:20,772 - INFO - {'task': 'traffic_state_pred', 'model': 'AGCRN', 'dataset': 'CHITaxi20190406', 'saved_model': True, 'train': True, 'embedding_model': 'TransE', 'load_external': True, 'seed': 919985480, 'exp_id': 0, 'max_epoch': 5, 'metrics': ['MAE', 'RMSE'], 'cache_dataset': False, 'dataset_class': 'TrafficStatePointDataset', 'executor': 'TrafficStateExecutor', 'evaluator': 'TrafficStateEvaluator', 'embed_dim': 10, 'rnn_units': 64, 'num_layers': 2, 'cheb_order': 2, 'bidir_adj_mx': True, 'scaler': 'standard', 'normal_external': False, 'ext_scaler': 'none', 'add_time_in_day': False, 'add_day_in_week': False, 'learner': 'adam', 'learning_rate': 0.003, 'lr_decay': False, 'clip_grad_norm': False, 'use_early_stop': True, 'patience': 50, 'batch_size': 64, 'num_workers': 0, 'pad_with_last_sample': True, 'train_rate': 0.7, 'eval_rate': 0.1, 'input_window': 12, 'output_window': 12, 'gpu': True, 'gpu_id': 0, 'train_loss': 'none', 'epoch': 0, 'weight_decay': 0, 'lr_epsilon': 1e-08, 'lr_beta1': 0.9, 'lr_beta2': 0.999, 'lr_alpha': 0.99, 'lr_momentum': 0, 'lr_scheduler': 'multisteplr', 'lr_decay_ratio': 0.1, 'steps': [5, 20, 40, 70], 'step_size': 10, 'lr_T_max': 30, 'lr_eta_min': 0, 'lr_patience': 10, 'lr_threshold': 0.0001, 'max_grad_norm': 1.0, 'log_level': 'INFO', 'log_every': 1, 'load_best_epoch': True, 'hyper_tune': False, 'evaluator_mode': 'single', 'save_mode': ['csv'], 'geo': {'including_types': ['Point'], 'Point': {}}, 'rel': {'including_types': ['geo'], 'geo': {'cost': 'num'}}, 'dyna': {'including_types': ['state'], 'state': {'entity_id': 'geo_id', 'traffic_speed': 'num'}}, 'data_col': ['inflow', 'outflow'], 'weight_col': 'cost', 'data_files': ['CHITaxi20190406'], 'geo_file': 'CHITaxi20190406', 'rel_file': 'CHITaxi20190406', 'output_dim': 2, 'time_intervals': 4368, 'init_weight_inf_or_zero': 'inf', 'set_weight_link_or_dist': 'dist', 'calculate_weight_adj': True, 'weight_adj_epsilon': 0.1, 'embedding_type': 'area', 'device': device(type='cuda', index=0)}
2024-04-22 23:48:20,784 - INFO - Loaded file CHITaxi20190406.geo, num_nodes=77
2024-04-22 23:48:20,791 - INFO - set_weight_link_or_dist: dist
2024-04-22 23:48:20,791 - INFO - init_weight_inf_or_zero: inf
2024-04-22 23:48:20,806 - INFO - Loaded file CHITaxi20190406.rel, shape=(77, 77)
2024-04-22 23:48:20,806 - INFO - Start Calculate the weight by Gauss kernel!
2024-04-22 23:48:20,807 - INFO - Loading file CHITaxi20190406.dyna
2024-04-22 23:48:21,000 - INFO - Loaded file CHITaxi20190406.dyna, shape=(4368, 77, 2)
2024-04-22 23:48:23,421 - INFO - Dataset created
2024-04-22 23:48:23,421 - INFO - x shape: (4345, 12, 77, 34), y shape: (4345, 12, 77, 34)
2024-04-22 23:48:23,594 - INFO - train	x: (3042, 12, 77, 34), y: (3042, 12, 77, 34)
2024-04-22 23:48:23,594 - INFO - eval	x: (434, 12, 77, 34), y: (434, 12, 77, 34)
2024-04-22 23:48:23,595 - INFO - test	x: (869, 12, 77, 34), y: (869, 12, 77, 34)
2024-04-22 23:48:23,812 - INFO - StandardScaler mean: 11.137838123415046, std: 53.15358218315973
2024-04-22 23:48:23,812 - INFO - NoneScaler
2024-04-22 23:48:27,441 - INFO - AGCRN(
  (encoder): AVWDCRNN(
    (dcrnn_cells): ModuleList(
      (0): AGCRNCell(
        (gate): AVWGCN()
        (update): AVWGCN()
      )
      (1): AGCRNCell(
        (gate): AVWGCN()
        (update): AVWGCN()
      )
    )
  )
  (end_conv): Conv2d(1, 24, kernel_size=(1, 64), stride=(1, 1))
)
2024-04-22 23:48:27,441 - INFO - node_embeddings	torch.Size([77, 10])	cuda:0	True
2024-04-22 23:48:27,441 - INFO - encoder.dcrnn_cells.0.gate.weights_pool	torch.Size([10, 2, 98, 128])	cuda:0	True
2024-04-22 23:48:27,441 - INFO - encoder.dcrnn_cells.0.gate.bias_pool	torch.Size([10, 128])	cuda:0	True
2024-04-22 23:48:27,441 - INFO - encoder.dcrnn_cells.0.update.weights_pool	torch.Size([10, 2, 98, 64])	cuda:0	True
2024-04-22 23:48:27,442 - INFO - encoder.dcrnn_cells.0.update.bias_pool	torch.Size([10, 64])	cuda:0	True
2024-04-22 23:48:27,442 - INFO - encoder.dcrnn_cells.1.gate.weights_pool	torch.Size([10, 2, 128, 128])	cuda:0	True
2024-04-22 23:48:27,442 - INFO - encoder.dcrnn_cells.1.gate.bias_pool	torch.Size([10, 128])	cuda:0	True
2024-04-22 23:48:27,442 - INFO - encoder.dcrnn_cells.1.update.weights_pool	torch.Size([10, 2, 128, 64])	cuda:0	True
2024-04-22 23:48:27,442 - INFO - encoder.dcrnn_cells.1.update.bias_pool	torch.Size([10, 64])	cuda:0	True
2024-04-22 23:48:27,442 - INFO - end_conv.weight	torch.Size([24, 1, 1, 64])	cuda:0	True
2024-04-22 23:48:27,442 - INFO - end_conv.bias	torch.Size([24])	cuda:0	True
2024-04-22 23:48:27,442 - INFO - Total parameter numbers: 874010
2024-04-22 23:48:27,442 - INFO - You select `adam` optimizer.
2024-04-22 23:48:27,443 - WARNING - Received none train loss func and will use the loss func defined in the model.
2024-04-22 23:48:27,443 - INFO - Start training ...
2024-04-22 23:48:27,443 - INFO - num_batches:48
2024-04-22 23:48:49,019 - INFO - epoch complete!
2024-04-22 23:48:49,019 - INFO - evaluating now!
2024-04-22 23:48:50,403 - INFO - Epoch [0/5] train_loss: 24.7757, val_loss: 18.6527, lr: 0.003000, 22.96s
2024-04-22 23:48:50,427 - INFO - Saved model at 0
2024-04-22 23:48:50,427 - INFO - Val loss decrease from inf to 18.6527, saving to ./libcity/cache/0/model_cache/AGCRN_CHITaxi20190406_epoch0.tar
2024-04-22 23:49:11,276 - INFO - epoch complete!
2024-04-22 23:49:11,276 - INFO - evaluating now!
2024-04-22 23:49:12,667 - INFO - Epoch [1/5] train_loss: 15.1869, val_loss: 15.1218, lr: 0.003000, 22.24s
2024-04-22 23:49:12,691 - INFO - Saved model at 1
2024-04-22 23:49:12,691 - INFO - Val loss decrease from 18.6527 to 15.1218, saving to ./libcity/cache/0/model_cache/AGCRN_CHITaxi20190406_epoch1.tar
2024-04-22 23:49:33,612 - INFO - epoch complete!
2024-04-22 23:49:33,612 - INFO - evaluating now!
2024-04-22 23:49:35,022 - INFO - Epoch [2/5] train_loss: 12.7135, val_loss: 12.3060, lr: 0.003000, 22.33s
2024-04-22 23:49:35,046 - INFO - Saved model at 2
2024-04-22 23:49:35,046 - INFO - Val loss decrease from 15.1218 to 12.3060, saving to ./libcity/cache/0/model_cache/AGCRN_CHITaxi20190406_epoch2.tar
2024-04-22 23:49:56,147 - INFO - epoch complete!
2024-04-22 23:49:56,148 - INFO - evaluating now!
2024-04-22 23:49:57,548 - INFO - Epoch [3/5] train_loss: 10.3149, val_loss: 9.8403, lr: 0.003000, 22.50s
2024-04-22 23:49:57,572 - INFO - Saved model at 3
2024-04-22 23:49:57,573 - INFO - Val loss decrease from 12.3060 to 9.8403, saving to ./libcity/cache/0/model_cache/AGCRN_CHITaxi20190406_epoch3.tar
2024-04-22 23:50:18,634 - INFO - epoch complete!
2024-04-22 23:50:18,634 - INFO - evaluating now!
2024-04-22 23:50:20,064 - INFO - Epoch [4/5] train_loss: 8.7656, val_loss: 8.5470, lr: 0.003000, 22.49s
2024-04-22 23:50:20,092 - INFO - Saved model at 4
2024-04-22 23:50:20,092 - INFO - Val loss decrease from 9.8403 to 8.5470, saving to ./libcity/cache/0/model_cache/AGCRN_CHITaxi20190406_epoch4.tar
2024-04-22 23:50:20,092 - INFO - Trained totally 5 epochs, average train time is 21.101s, average eval time is 1.403s
2024-04-22 23:50:20,107 - INFO - Loaded model at 4
2024-04-22 23:50:20,108 - INFO - Saved model at ./libcity/cache/0/model_cache/AGCRN_CHITaxi20190406.m
2024-04-22 23:50:20,129 - INFO - Start evaluating ...
2024-04-22 23:50:23,045 - INFO - Note that you select the single mode to evaluate!
2024-04-22 23:50:23,050 - INFO - Evaluate result is saved at ./libcity/cache/0/evaluate_cache\AGCRN_CHITaxi20190406.csv
2024-04-22 23:50:23,054 - INFO - 
         MAE       RMSE
1   3.588812  15.199519
2   3.572731  14.775671
3   3.707746  15.310237
4   3.945975  16.382446
5   4.083230  17.137606
6   4.279203  18.122337
7   4.553508  19.227976
8   4.761688  20.590664
9   5.135164  21.978167
10  5.425441  23.114130
11  5.618140  24.305630
12  5.954999  25.339399
2024-04-22 23:50:23,225 - INFO - ----------------------------------------------------------------------------
2024-04-22 23:50:23,225 - INFO - # 1, Kownledge Graph Embedding: True, Experiment ids: 1
2024-04-22 23:50:23,225 - INFO - ----------------------------------------------------------------------------
2024-04-22 23:50:23,228 - INFO - Log directory: ./libcity/log
2024-04-22 23:50:23,228 - INFO - Begin pipeline, task=traffic_state_pred, model_name=AGCRN, dataset_name=CHITaxi20190406, exp_id=1
2024-04-22 23:50:23,228 - INFO - {'task': 'traffic_state_pred', 'model': 'AGCRN', 'dataset': 'CHITaxi20190406', 'saved_model': True, 'train': True, 'embedding_model': 'TransE', 'load_external': True, 'seed': 797452410, 'exp_id': 1, 'max_epoch': 5, 'metrics': ['MAE', 'RMSE'], 'cache_dataset': False, 'dataset_class': 'TrafficStatePointDataset', 'executor': 'TrafficStateExecutor', 'evaluator': 'TrafficStateEvaluator', 'embed_dim': 10, 'rnn_units': 64, 'num_layers': 2, 'cheb_order': 2, 'bidir_adj_mx': True, 'scaler': 'standard', 'normal_external': False, 'ext_scaler': 'none', 'add_time_in_day': False, 'add_day_in_week': False, 'learner': 'adam', 'learning_rate': 0.003, 'lr_decay': False, 'clip_grad_norm': False, 'use_early_stop': True, 'patience': 50, 'batch_size': 64, 'num_workers': 0, 'pad_with_last_sample': True, 'train_rate': 0.7, 'eval_rate': 0.1, 'input_window': 12, 'output_window': 12, 'gpu': True, 'gpu_id': 0, 'train_loss': 'none', 'epoch': 0, 'weight_decay': 0, 'lr_epsilon': 1e-08, 'lr_beta1': 0.9, 'lr_beta2': 0.999, 'lr_alpha': 0.99, 'lr_momentum': 0, 'lr_scheduler': 'multisteplr', 'lr_decay_ratio': 0.1, 'steps': [5, 20, 40, 70], 'step_size': 10, 'lr_T_max': 30, 'lr_eta_min': 0, 'lr_patience': 10, 'lr_threshold': 0.0001, 'max_grad_norm': 1.0, 'log_level': 'INFO', 'log_every': 1, 'load_best_epoch': True, 'hyper_tune': False, 'evaluator_mode': 'single', 'save_mode': ['csv'], 'geo': {'including_types': ['Point'], 'Point': {}}, 'rel': {'including_types': ['geo'], 'geo': {'cost': 'num'}}, 'dyna': {'including_types': ['state'], 'state': {'entity_id': 'geo_id', 'traffic_speed': 'num'}}, 'data_col': ['inflow', 'outflow'], 'weight_col': 'cost', 'data_files': ['CHITaxi20190406'], 'geo_file': 'CHITaxi20190406', 'rel_file': 'CHITaxi20190406', 'output_dim': 2, 'time_intervals': 4368, 'init_weight_inf_or_zero': 'inf', 'set_weight_link_or_dist': 'dist', 'calculate_weight_adj': True, 'weight_adj_epsilon': 0.1, 'embedding_type': 'area', 'device': device(type='cuda', index=0)}
2024-04-22 23:50:23,235 - INFO - Loaded file CHITaxi20190406.geo, num_nodes=77
2024-04-22 23:50:23,241 - INFO - set_weight_link_or_dist: dist
2024-04-22 23:50:23,241 - INFO - init_weight_inf_or_zero: inf
2024-04-22 23:50:23,256 - INFO - Loaded file CHITaxi20190406.rel, shape=(77, 77)
2024-04-22 23:50:23,256 - INFO - Start Calculate the weight by Gauss kernel!
2024-04-22 23:50:23,257 - INFO - Loading file CHITaxi20190406.dyna
2024-04-22 23:50:23,438 - INFO - Loaded file CHITaxi20190406.dyna, shape=(4368, 77, 2)
2024-04-22 23:50:25,870 - INFO - Dataset created
2024-04-22 23:50:25,870 - INFO - x shape: (4345, 12, 77, 34), y shape: (4345, 12, 77, 34)
2024-04-22 23:50:26,037 - INFO - train	x: (3042, 12, 77, 34), y: (3042, 12, 77, 34)
2024-04-22 23:50:26,037 - INFO - eval	x: (434, 12, 77, 34), y: (434, 12, 77, 34)
2024-04-22 23:50:26,037 - INFO - test	x: (869, 12, 77, 34), y: (869, 12, 77, 34)
2024-04-22 23:50:26,220 - INFO - StandardScaler mean: 11.137838123415046, std: 53.15358218315973
2024-04-22 23:50:26,220 - INFO - NoneScaler
2024-04-22 23:50:28,094 - INFO - AGCRN(
  (encoder): AVWDCRNN(
    (dcrnn_cells): ModuleList(
      (0): AGCRNCell(
        (gate): AVWGCN()
        (update): AVWGCN()
      )
      (1): AGCRNCell(
        (gate): AVWGCN()
        (update): AVWGCN()
      )
    )
  )
  (end_conv): Conv2d(1, 24, kernel_size=(1, 64), stride=(1, 1))
)
2024-04-22 23:50:28,094 - INFO - node_embeddings	torch.Size([77, 10])	cuda:0	True
2024-04-22 23:50:28,095 - INFO - encoder.dcrnn_cells.0.gate.weights_pool	torch.Size([10, 2, 98, 128])	cuda:0	True
2024-04-22 23:50:28,095 - INFO - encoder.dcrnn_cells.0.gate.bias_pool	torch.Size([10, 128])	cuda:0	True
2024-04-22 23:50:28,095 - INFO - encoder.dcrnn_cells.0.update.weights_pool	torch.Size([10, 2, 98, 64])	cuda:0	True
2024-04-22 23:50:28,095 - INFO - encoder.dcrnn_cells.0.update.bias_pool	torch.Size([10, 64])	cuda:0	True
2024-04-22 23:50:28,096 - INFO - encoder.dcrnn_cells.1.gate.weights_pool	torch.Size([10, 2, 128, 128])	cuda:0	True
2024-04-22 23:50:28,096 - INFO - encoder.dcrnn_cells.1.gate.bias_pool	torch.Size([10, 128])	cuda:0	True
2024-04-22 23:50:28,096 - INFO - encoder.dcrnn_cells.1.update.weights_pool	torch.Size([10, 2, 128, 64])	cuda:0	True
2024-04-22 23:50:28,096 - INFO - encoder.dcrnn_cells.1.update.bias_pool	torch.Size([10, 64])	cuda:0	True
2024-04-22 23:50:28,097 - INFO - end_conv.weight	torch.Size([24, 1, 1, 64])	cuda:0	True
2024-04-22 23:50:28,097 - INFO - end_conv.bias	torch.Size([24])	cuda:0	True
2024-04-22 23:50:28,097 - INFO - Total parameter numbers: 874010
2024-04-22 23:50:28,097 - INFO - You select `adam` optimizer.
2024-04-22 23:50:28,098 - WARNING - Received none train loss func and will use the loss func defined in the model.
2024-04-22 23:50:28,098 - INFO - Start training ...
2024-04-22 23:50:28,098 - INFO - num_batches:48
2024-04-22 23:50:49,344 - INFO - epoch complete!
2024-04-22 23:50:49,345 - INFO - evaluating now!
2024-04-22 23:50:51,220 - INFO - Epoch [0/5] train_loss: 24.1491, val_loss: 19.0804, lr: 0.003000, 23.12s
2024-04-22 23:50:51,252 - INFO - Saved model at 0
2024-04-22 23:50:51,253 - INFO - Val loss decrease from inf to 19.0804, saving to ./libcity/cache/1/model_cache/AGCRN_CHITaxi20190406_epoch0.tar
2024-04-22 23:51:12,692 - INFO - epoch complete!
2024-04-22 23:51:12,692 - INFO - evaluating now!
2024-04-22 23:51:14,098 - INFO - Epoch [1/5] train_loss: 16.0288, val_loss: 15.8618, lr: 0.003000, 22.85s
2024-04-22 23:51:14,122 - INFO - Saved model at 1
2024-04-22 23:51:14,123 - INFO - Val loss decrease from 19.0804 to 15.8618, saving to ./libcity/cache/1/model_cache/AGCRN_CHITaxi20190406_epoch1.tar
2024-04-22 23:51:35,431 - INFO - epoch complete!
2024-04-22 23:51:35,431 - INFO - evaluating now!
2024-04-22 23:51:36,849 - INFO - Epoch [2/5] train_loss: 13.3037, val_loss: 13.2133, lr: 0.003000, 22.73s
2024-04-22 23:51:36,873 - INFO - Saved model at 2
2024-04-22 23:51:36,873 - INFO - Val loss decrease from 15.8618 to 13.2133, saving to ./libcity/cache/1/model_cache/AGCRN_CHITaxi20190406_epoch2.tar
2024-04-22 23:51:58,344 - INFO - epoch complete!
2024-04-22 23:51:58,344 - INFO - evaluating now!
2024-04-22 23:51:59,779 - INFO - Epoch [3/5] train_loss: 10.8533, val_loss: 10.6191, lr: 0.003000, 22.91s
2024-04-22 23:51:59,805 - INFO - Saved model at 3
2024-04-22 23:51:59,805 - INFO - Val loss decrease from 13.2133 to 10.6191, saving to ./libcity/cache/1/model_cache/AGCRN_CHITaxi20190406_epoch3.tar
2024-04-22 23:52:21,415 - INFO - epoch complete!
2024-04-22 23:52:21,415 - INFO - evaluating now!
2024-04-22 23:52:22,862 - INFO - Epoch [4/5] train_loss: 9.2645, val_loss: 8.8351, lr: 0.003000, 23.05s
2024-04-22 23:52:22,892 - INFO - Saved model at 4
2024-04-22 23:52:22,893 - INFO - Val loss decrease from 10.6191 to 8.8351, saving to ./libcity/cache/1/model_cache/AGCRN_CHITaxi20190406_epoch4.tar
2024-04-22 23:52:22,893 - INFO - Trained totally 5 epochs, average train time is 21.414s, average eval time is 1.516s
2024-04-22 23:52:22,908 - INFO - Loaded model at 4
2024-04-22 23:52:22,908 - INFO - Saved model at ./libcity/cache/1/model_cache/AGCRN_CHITaxi20190406.m
2024-04-22 23:52:22,930 - INFO - Start evaluating ...
2024-04-22 23:52:26,034 - INFO - Note that you select the single mode to evaluate!
2024-04-22 23:52:26,038 - INFO - Evaluate result is saved at ./libcity/cache/1/evaluate_cache\AGCRN_CHITaxi20190406.csv
2024-04-22 23:52:26,042 - INFO - 
         MAE       RMSE
1   4.028545  17.365896
2   3.889204  16.243916
3   4.021807  17.141996
4   4.111163  17.363384
5   4.421821  18.866877
6   4.535207  19.428921
7   4.775592  20.676138
8   4.967443  21.532934
9   5.203244  22.151356
10  5.573004  24.015413
11  5.878428  25.155931
12  6.123347  25.886972
2024-04-22 23:52:26,236 - INFO - ----------------------------------------------------------------------------
2024-04-22 23:52:26,236 - INFO - Kownledge Graph Embedding: True, Experiment ids: [0, 1]
2024-04-22 23:52:26,243 - INFO - ----------------------------------------------------------------------------
2024-04-22 23:52:26,249 - INFO - Average: 
         MAE       RMSE
0   3.808678  16.282708
1   3.730968  15.509793
2   3.864777  16.226117
3   4.028569  16.872915
4   4.252526  18.002241
5   4.407205  18.775629
6   4.664550  19.952057
7   4.864566  21.061799
8   5.169204  22.064761
9   5.499222  23.564772
10  5.748284  24.730781
11  6.039173  25.613186 
2024-04-22 23:52:26,256 - INFO - Standard deviation: 
         MAE      RMSE
0   0.219867  1.083189
1   0.158236  0.734122
2   0.157031  0.915880
3   0.082594  0.490469
4   0.169295  0.864635
5   0.128002  0.653292
6   0.111042  0.724081
7   0.102878  0.471135
8   0.034040  0.086595
9   0.073781  0.450642
10  0.130144  0.425151
11  0.084174  0.273787
2024-04-22 23:52:26,263 - INFO - ----------------------------------------------------------------------------
2024-04-22 23:52:26,270 - INFO - 12 steps Average: 
        MAE       RMSE
0  4.673143  19.888063
2024-04-22 23:52:26,274 - INFO - 12 steps Standard deviation: 
        MAE      RMSE
0  0.120924  0.597748
